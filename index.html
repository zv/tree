<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>Zephyr's Tree</title>
    <script type="text/javascript">
      function draw() {
      if (canvas.getContext){
         ctx = canvas.getContext('2d');
      }

      var render = new RenderTree(size, front, back, trunk, trunk_stroke, grains, ctx)
        var tree = new Tree(mid,
                            0.90,
                            init_branch,
                            (-1*PI)*0.5,
                            one,
                            one,
                            branch_split_angle,
                            branch_prob_scale,
                            branch_diminish,
                            branch_split_diminish,
                            branch_angle_max,
                            branch_angle_exp)

      ctx.fillStyle = "rgba(0,0,0,0.5)";

        function drawStep() {
          tree.step()
          tree.Q.map((x) => render.drawBranch(x))

          if (tree.Q.length) {
            setTimeout(drawStep, 25)
          } else {
            console.log("done")
          }
        }

        drawStep();
      }
    </script>
  </head>
  <body onload="draw();">
    <canvas id="tree" width="600" height="600"></canvas>

    <script type="text/javascript">

     function uniformRandom(n) {
       if (n) {
         return randomInteger(n)
       }
       return Math.random()
     }

     function randomInteger(n) {
       return Math.floor(Math.random() * n)
     }


      function normalDistribution() {
      var u = 1 - Math.random(); // Subtraction to flip [0, 1) to (0, 1].
      var v = 1 - Math.random();
      return Math.sqrt( -2.0 * Math.log( u ) ) * Math.cos( 2.0 * Math.PI * v );

      }
      const PI = Math.PI
      canvas = document.getElementById('tree');
      const size  = canvas.width
      const one   = 1/size

      // const #pi5 = 0.5*pi

      const mid = 0.5
      const init_branch = size*0.03*one
      const grains = Math.floor(size*0.02)

      const branch_diminish       = one/32
      const branch_split_diminish = 0.71
      const branch_prob_scale     = 1/(init_branch)/size*20
      const branch_split_angle    = 0.3*PI
      const branch_angle_max      = 5*PI/size
      const branch_angle_exp      = 2

      const back         = "rgba(255,255,255,0)"
      const front        = "rgba(0,0,0,0.5)"
      const trunk_stroke = "rgba(0,0,0,1)"
      const trunk        = "rgba(255,255,255,1)"
      const trunk_shade  = "rgba(0,0,0,0.5)"




    </script>

    <script type="text/javascript" src="./tree.js"></script>
    <script type="text/javascript" src="./render.js"></script>
  </body>
</html>
